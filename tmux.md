# tmux 配置 #

## 安装 tmux ##

```shell
apt-get update
apt-get install -y tmux vim git locales
echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
locale-gen
```

```shell
tmux -V
# tmux 2.3
```

## 基础配置 ##

基础配置来源于 [gpakosz.tmux](https://raw.githubusercontent.com/gpakosz/.tmux/master/.tmux.conf)

```shell
cd ~
git clone https://github.com/gpakosz/.tmux.git
ln -s -f .tmux/.tmux.conf
cp .tmux/.tmux.conf.local .
```

## 修改基础配置 ##

```shell
# 放到 .tmux.conf.local 的末尾
# 调整 window 名称的摆放位置
set -g status-justify centre

# 调整 prefix
unbind C-b
set -g prefix C-a
bind C-a send-prefix -2

# 将 repeat-time 调长
# 使 {prefix} + key 更像是按 {prefix} 进入命令模式，按 key 输入命令
# 需要退出的时候通过 Esc 来退出
set -sg repeat-time 6000

bind S command-prompt -p "(rename-session): " "rename-session '%1'"
bind W command-prompt -p "(rename-window): " "rename-window '%1'"
run -b "printf '\033]2;%s\033\\' 'title goes here'"
set -g pane-border-status top
set -g pane-border-format "#P: #{pane_current_path} #{pane_current_command}"

# Use arrow keys to switch windows
bind -r Left previous-window
bind -r Right next-window

# 调整分割 pane 的按键
# 建议一个 window 内最多有两个 pane
unbind '"'
unbind %
bind - split-window -v
bind \ split-window -h
bind _ select-layout even-vertical
bind | select-layout even-horizontal

# copy-mode 支持 vim 键位
# 列模式选中需要 control-v v
set -wg mode-keys vi
# tmux 与 iTerm2 共享剪贴板
# iTerm2 -> Preferences -> Applications in terminal may access clipboard
```

## 安装插件 ##

### 安装插件管理器 ###

```shell
cd ~
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
```

```shell
# cat << EOF > /dev/null
# https://github.com/gpakosz/.tmux
# (‑●‑●)> dual licensed under the WTFPL v2 license and the MIT license,
#         without any warranty.
#         Copyright 2012— Gregory Pakosz (@gpakosz).
# /!\ do not edit this file
#     instead, override settings in ~/.tmux.conf.local, see README.md

# List of plugins
set -g @plugin 'tmux-plugins/tpm'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'
```

|    command     | function |
| :------------: | :------: |
|   {prefix} I   |   安装   |
|   {prefix} U   |   升级   |
| {prefix} alt u |   卸载   |

### 安装插件 ###

```shell
# 插件需要使用 tree 命令
apt-get install tree
```

```shell
set -g @plugin 'tmux-plugins/tmux-sidebar'
set -g @sidebar-tree-position 'right'
set -g @sidebar-tree-command 'tree -C'
```

{prefix} delete 打开目录树且转移键盘焦点，键位和 vim 保持一致

{prefix} Tab 打开目录树但不转移焦点

{prefix} delete / {prefix} Tab 都可以关闭目录树

```shell
set -g @plugin 'tmux-plugins/tmux-sessionist'
```

```shell
# .tmux/plugins/tmux-sessionist/sessionist.tmux
default_key_bindings_alternate="S" -> default_key_bindings_alternate="M"
# 解除对之前快捷键的干扰
```

{prefix} C 创建新 session

{prefix} g 列出所有 session 并跳转

{prefix} X 删除 session 且不退出 tmux

```shell
set -g @plugin 'tmux-plugins/tmux-logging'
```

{prefix} P 开始录制以及停止录制

# 常用快捷键整理 #

|          |                tmux                 |
| :------: | :---------------------------------: |
|  attach  |     tmux new -s {session_name}      |
|  detach  |             {prefix} d              |
|   list   |               tmux ls               |
| reattach |     tmux attach {session_name}      |
|   kill   | tmux kill-session -t {session_name} |

|                   |    session     |                window                 |        pane        |
| :---------------: | :------------: | :-----------------------------------: | :----------------: |
|      create       |   {prefix} C   |              {prefix} c               |  {prefix} (-/\\)   |
|      rename       | {prefix} ($/S) |              {prefix} W               |                    |
|      destroy      |   {prefix} X   |              {prefix} &               |     {prefix} x     |
|  fast navigation  | {prefix} {(/)} | {prefix} {0-9/arrow-left/arrow-right} | {prefix} (h/j/k/l) |
| list & navigation | {prefix} {s/g} |              {prefix} w               |                    |
|   change layout   |                |                                       |  {prefix} (_/\|)   |

|    key     |     function      |
| :--------: | :---------------: |
| {prefix} + |  pane to window   |
| {prefix} - |  window to pane   |
| {prefix} @ |  pane to session  |
|            |  session to pane  |
| {prefix} @ | window to session |
|            | session to window |

# Other Tips #

`ssh -t user@seler 'cd workdir; do something; bash'`

control-x control-e 可以用编辑器编辑命令

利用 bind-key 还可以发送一些常用命令到 shell

```shell
# C-m is a carriage return in Tmux.
tmux bind -g r send-keys 'ls' C-m
```

# 参考及进阶 #

[gpakosz.tmux](https://raw.githubusercontent.com/gpakosz/.tmux/master/.tmux.conf)

[tmux-plugins/tmux-sessionist](https://github.com/tmux-plugins/tmux-sessionist)

[tmux-plugins/tmux-logging](https://github.com/tmux-plugins/tmux-logging)

[Tmux and Vim - even better together](https://blog.bugsnag.com/tmux-and-vim)

[rothgar/awesome-tmux](https://github.com/rothgar/awesome-tmux)

[Custom Vim Bindings in tmux 2.4](https://shapeshed.com/custom-vim-bindings-in-tmux-2-4)

[Increased Developer Productivity with Tmux](https://minimul.com/increased-developer-productivity-with-tmux-part-5.html)